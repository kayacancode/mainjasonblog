# Database Migration Instructions

## Adding Preference Columns to Images Table

To enable the new features (cover track selection and custom tracklist titles), you need to run a database migration.

### Option 1: Supabase Dashboard (Recommended)

1. Go to your Supabase project dashboard
2. Navigate to **SQL Editor**
3. Copy and paste the following SQL:

```sql
-- Add columns for preferred track selection
ALTER TABLE images 
ADD COLUMN IF NOT EXISTS preferred_track_id BIGINT,
ADD COLUMN IF NOT EXISTS preferred_track_name TEXT,
ADD COLUMN IF NOT EXISTS preferred_track_image TEXT;

-- Add column for custom tracklist title
ALTER TABLE images 
ADD COLUMN IF NOT EXISTS tracklist_title TEXT;

-- Add column for custom processed image URL (with overlay)
ALTER TABLE images 
ADD COLUMN IF NOT EXISTS custom_image_url TEXT;
```

4. Click **Run** to execute the migration

### Option 2: Using the Migration File

The migration SQL is also available in `supabase/migrations/001_add_preference_columns.sql`

You can use Supabase CLI to apply it:
```bash
supabase db push
```

### Verification

After running the migration, you can verify the columns were added by:

1. Going to **Table Editor** in Supabase
2. Selecting the `images` table
3. Checking that the new columns appear:
   - `preferred_track_id` (bigint)
   - `preferred_track_name` (text)
   - `preferred_track_image` (text)
   - `tracklist_title` (text)
   - `custom_image_url` (text)

### What These Columns Do

- **preferred_track_id**: Stores the ID of the track selected as the cover image
- **preferred_track_name**: Stores the track name for reference
- **preferred_track_image**: Stores the album art URL of the preferred track
- **tracklist_title**: Stores a custom title for the tracklist graphic (optional)
- **custom_image_url**: Stores the URL of the processed cover image with branding overlay

These preferences are preserved when new images are generated by the automation.

